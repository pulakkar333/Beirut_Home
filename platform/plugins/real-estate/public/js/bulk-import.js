(()=>{function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,a,i,s=[],l=!0,c=!1;try{if(a=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;l=!1}else for(;!(l=(n=a.call(o)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=o.return&&(i=o.return(),Object(i)!==i))return}finally{if(c)throw r}}return s}}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function o(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return r(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=Array(t);o<t;o++)n[o]=e[o];return n}$((function(){var n=$(document).find("#bulk-import"),r=n.find(".form-import-data"),a=n.find(".btn-import"),i=[],s=0;$(document).on("click",".btn-import",(function(e){e.preventDefault(),u.getQueuedFiles().length>0&&(Botble.showButtonLoading(a),n.find(".show-errors").hide(),s=0,i=[],u.processQueue()),u.on("sending",(function(){n.find(".bulk-import-message").removeClass("alert-success").addClass("alert-info").text(a.data("uploading-text")).show()})),u.on("error",(function(e,t){Botble.showError(t.message)}))}));var l=function(f){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;0===d&&n.find(".bulk-import-message").text(a.data("validating-text")),$httpClient.make().post(r.data("validate-url"),{file:f,offset:d,limit:m,update_existing:$("#update-existing").is(":checked")?1:0}).then((function(r){var d=r.data,m=d.data,p=d.message;if(m&&m.failed&&Object.keys(m.failed).length>0){i=[].concat(o(i),o(m.failed)),s+=m.count;var h=n.find("#imported-listing"),y=n.find(".show-errors"),b=$(document).find("#failure-template").html(),g="";i.forEach((function(o,n){var r=void 0!==o.row?o.row:n+1,a=[];console.log("Error data structure:",o),Array.isArray(o.errors)?a=o.errors:"object"===t(o.errors)&&null!==o.errors&&Object.entries(o.errors).forEach((function(t){var o=e(t,2),n=o[0],r=o[1];Array.isArray(r)?r.forEach((function(e){a.push("".concat(n,": ").concat(e))})):"string"==typeof r&&a.push("".concat(n,": ").concat(r))})),0===a.length&&"object"===t(o)&&null!==o&&Object.entries(o).forEach((function(t){var o=e(t,2),n=o[0],r=o[1];"row"!==n&&Array.isArray(r)?r.forEach((function(e){a.push("".concat(n,": ").concat(e))})):"row"!==n&&"string"==typeof r&&a.push("".concat(n,": ").concat(r))})),g+=b.replace("__row__",r).replace("__errors__",a.join(", "))})),y.show(),n.find(".main-form-message").show(),h.show().html(g),i=[],s=0,Botble.hideButtonLoading(a),u.removeAllFiles(),n.find(".bulk-import-message").hide()}else m&&m.count>0?(n.find(".bulk-import-message").show(),n.find(".bulk-import-message").text(p),l(f,m.offset),i=[].concat(o(i),o(m.failed)),s+=m.count):c(f)}))},c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;0===t&&(n.find(".bulk-import-message").text(a.data("importing-text")),Botble.showButtonLoading(a)),$httpClient.make().post(r.data("import-url"),{file:e,offset:t,limit:o,update_existing:$("#update-existing").is(":checked")?1:0}).then((function(t){var o=t.data,r=o.data,i=o.message,l=n.find(".processing"),f=l.find(".process");r&&r.count>0?(l.show(),c(e,r.offset),f.css("width",r.offset/s*100+"%"),n.find(".bulk-import-message").html(i)):(Botble.showSuccess(i),r.total_message&&(n.find(".main-form-message").show(),n.find(".bulk-import-message").removeClass("alert-info").addClass("alert-success").text(r.total_message).show(),u.removeAllFiles(),l.hide(),s=0,Botble.hideButtonLoading(a)))}))},u=new Dropzone(".import-dropzone",{url:r.data("upload-url"),method:"post",headers:{"X-CSRF-TOKEN":r.find("input[name=_token]").val()},previewTemplate:$(document).find("#preview-template").html(),autoProcessQueue:!1,chunking:!0,chunkSize:1048576,acceptedFiles:r.find(".import-properties-dropzone").data("mimetypes"),maxFiles:1,maxfilesexceeded:function(e){this.removeFile(e)},success:function(e,t){var o=t.data;t.message;o&&o.file_path&&l(o.file_path)}}),f=!1;$(document).on("click",".download-template",(function(e){if(e.preventDefault(),!f){var t=$(e.currentTarget),o=t.data("extension"),n=t.html();t.html(t.data("downloading")),t.addClass("text-secondary"),f=!0,$httpClient.make().withResponseType("blob").post(t.data("url"),{extension:o}).then((function(e){var o=e.data,n=document.createElement("a"),r=window.URL.createObjectURL(o);n.href=r,n.download=t.data("filename"),document.body.append(n),n.click(),n.remove(),window.URL.revokeObjectURL(r)})).finally((function(){setTimeout((function(){t.html(n),t.removeClass("text-secondary"),f=!1}),2e3)}))}}))}))})();